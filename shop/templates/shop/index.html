<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Hello, world!</title>
    <style>
      .col-md-3{
        display: inline-block;
        margin-left: -6px;
      }
      .col-md-3 img{
        width: 100%;
        height: 355px;
      }
      body .carousel-indicator li{
        background-color: blue;
      }
      body .carousel-control-prev-icon,
      body .carousel-control-next-icon{
        background-color: blue;
      }
      body .no-padding{
        padding-left: 0px;
        padding-right: 0px;
      }
      body .carousel-indicators{
        bottom:0px;
      }
      .carousel-indicators .active{
        background-color: blue;
      }
    </style>
  </head>
  <body>
    {% load static %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="/shop">My Awesome Cart</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="/shop">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/shop/about">About Us</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/shop/tracker">Tracker</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/shop/contact">Contact Us</a>
      </li>
    </ul>
    <form method='get' action='/shop/search/' class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="search" name="search" placeholder="Search" aria-label="Search" id="search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
    <a href="#" class="hj"><button type="button" class="btn btn-secondary mx-2 h" id="pop" data-container="body" data-html="true" data-placement="bottom">
  Cart(<span id="cart1">0</span>)
</button></a>
<a href="/shop/checkout"><button type="submit" class="btn btn-secondary mx-2">Checkout</button></a>
  </div>
</nav>
<div class="container">
  {% for products,range,nSlides in allProds %}
  <div class="row">
<div id="demo{{forloop.counter}}" class="carousel slide my-3" data-ride="carousel">
<ul class="carousel-indicators">
<li data-target="#demo{{forloop.counter}}" data-slide-to="0" class="active"></li>
{% for i in range %}
<li data-target="#demo{{forloop.parentloop.counter}}" data-slide-to="{{i}}"></li>
{% endfor %}


</ul>

<!-- slideshow starts here-->
<div class="container carousel-inner no-padding">
  <div class="carousel-item active">
  {% for i in products %}
  <div class="col-xs-3 col-sm-3 col-md-3">
    <div class="card" style="width: 18rem;">
      <img src='/media/{{i.image}}' class="card-img-top" alt="...">
      <div class="card-body">
        <h5 class="card-title" id="namepr{{i.id}}">{{forloop.counter}}{{i.product_name}}</h5>
        <p class="card-text">{{i.desc}}</p>
        <h6 class="card-title">Price: <span id="pricepr{{i.id}}">{{i.price}}</span> Rs.</h6>
       <span id="divpr{{i.id}}" class="divpr"> <button id="pr{{i.id}}" class="btn btn-primary cart12">Add to Cart</button></span>
        <a href="/shop/productview/{{i.id}}"><button id="qv{{i.id}}" class="btn btn-primary ">QuickView</button></a>
  </div>
</div>

  </div>
  {% if forloop.counter|divisibleby:4 and forloop.counter > 0 and not forloop.last %}
  </div><div class="carousel-item">
  {% endif %}

  {% endfor %}
  </div>
</div>
<!--left and right control for the slide-->
<a class="carousel-control-prev" href="#demo{{forloop.counter}}" data-slide="prev">
  <span class="carousel-control-prev-icon"></span></a>

<a class="carousel-control-next" href="#demo{{forloop.counter}}" data-slide="next">
  <span class="carousel-control-next-icon"></span></a></div></div>{% endfor %}</div>
   
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src='https://co"e.jquery.com/jq"ery'3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src='https://cd"js.cloudflare.c"m/a'ax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src='https://st"ckpath.bootstra"cdn'com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
  <script src="http:////cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
      <script type="text/javascript">
console.log('working')
      //find out cart items from local storage
      $(document).ready(function(){
      if(localStorage.getItem('cart12')==null){
        var cart={};     }
      else{
        cart=JSON.parse(localStorage.getItem('cart12'));
        


      }
      console.log(cart);
        //if the add to cart button is clicked, add/increment the item 
        //$('.cart12').click(function(){
          $('.divpr').on('click','button.cart12',function(){
        console.log('clicked');
        var idstr=this.id.toString();
        console.log(idstr);
        if(cart[idstr]!=undefined){
          qty=cart[idstr][0]+1;
        }
        else{
          qty=1;
          name=document.getElementById('name'+idstr).innerHTML;
          price=document.getElementById('price'+idstr).innerHTML;
          cart[idstr]=[qty,name,parseInt(price)];
          
        }
        updatecart(cart);
        console.log(cart);
        var a=document.getElementById('cart1').innerHTML;
        console.log(a);
      });
       updatepopover(cart);
        function updatepopover(cart){
          console.log('we are inside new popover');
          var popstr="";
          popstr=popstr+"<h5>Cart</h5>";
          var i=1;
          for(var item in cart){
            popstr=popstr+"<b>"+i+"</b>. ";
            popstr=popstr+document.getElementById('name'+item).innerHTML+"Qty:"+cart[item][0]+"<br>";
            i+i+1;
          }
          popstr=popstr+"<a href='/shop/checkout/'><button class='btn btn-primary' id='checkout'>Checkout</button></a> <button class='btn btn-primary' onclick='clearcart()' id='clearcart'>Clear Cart</button>"
          console.log(popstr);
          
        document.getElementById('pop').setAttribute('data-content',popstr);
         $('#pop').popover('show');

        }

        function clearcart(){
          cart=JSON.parse(localStorage.getItem('cart'));
          for(var item in cart){
            document.getElementById('div'+item).innerHTML='<button id="'+item+'" class="btn btn-primary cart12">Add to Cart</button>'
          }
          localStorage.clear();
          cart={};
          updatecart(cart);

        }
        function updatecart(cart){
          for(var item in cart){
            document.getElementById('div'+item).innerHTML="<button id='minus"+item+"'class='btn btn-primary minus'>-</button> <span id='val"+item+"''>"+cart[item][0]+"</span><button id='plus"+item+"'class='btn btn-primary plus'>+</button>";
          }
                  localStorage.setItem('cart12',JSON.stringify(cart));
        document.getElementById('cart1').innerHTML=Object.keys(cart).length;
        updatepopover(cart);
        }
        $('.divpr').on("click","button.minus",function(){
          console.log('minus clicked');
          a=this.id.slice(7, );
          console.log(a);
          cart['pr'+a][0]=cart['pr'+a][0]-1;
          cart['pr'+a][0]=Math.max(0,cart['pr'+a][0]);
          document.getElementById('valpr'+a).innerHTML=cart['pr'+a][0];
          console.log(cart);
          updatecart(cart);
          console.log(cart);
        })
        

        $('.divpr').on("click","button.plus",function(){
          console.log('plus clicked');
          a=this.id.slice(6, );
          console.log(a);
          cart['pr'+a][0]=cart['pr'+a][0]+1;
          document.getElementById('valpr'+a).innerHTML=cart['pr'+a][0];
          console.log(cart);
          updatecart(cart);
          console.log(cart);
        })
        
      });
    </script>
  </body>
</html>